<div class="card-wrapper">
  <mat-card class="create-loan-card">
    <mat-toolbar class="card-toolbar"><b>Create New Loan</b></mat-toolbar>

    <form [formGroup]="loanForm" (ngSubmit)="createLoan()" class="loan-form">
      <div class="form-content">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Loan Amount (SOL)</mat-label>
          <input matInput type="number" formControlName="amount" min="0.1" step="0.1" />
          @if (loanForm.get('amount')?.hasError('required')) {
          <mat-error>Amount is required</mat-error>
          } @if (loanForm.get('amount')?.hasError('min')) {
          <mat-error>Minimum amount is 0.1 SOL</mat-error>
          }
        </mat-form-field>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Interest Rate (%)</mat-label>
          <input
            matInput
            type="number"
            formControlName="interestRate"
            min="1"
            max="50"
            step="0.1"
          />
          @if (loanForm.get('interestRate')?.hasError('required')) {
          <mat-error>Interest rate is required</mat-error>
          } @if (loanForm.get('interestRate')?.hasError('min') ||
          loanForm.get('interestRate')?.hasError('max')) {
          <mat-error>Interest rate must be between 1% and 50%</mat-error>
          }
        </mat-form-field>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Duration (days)</mat-label>
          <input matInput type="number" formControlName="durationDays" min="7" max="365" />
          @if (loanForm.get('durationDays')?.hasError('required')) {
          <mat-error>Duration is required</mat-error>
          } @if (loanForm.get('durationDays')?.hasError('min') ||
          loanForm.get('durationDays')?.hasError('max')) {
          <mat-error>Duration must be between 7 and 365 days</mat-error>
          }
        </mat-form-field>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Collateral (optional)</mat-label>
          <input
            matInput
            formControlName="collateral"
            placeholder="e.g., SOL tokens, NFT collection"
          />
        </mat-form-field>

        <div class="form-actions">
          <button
            mat-raised-button
            color="primary"
            type="submit"
            [disabled]="!loanForm.valid || !publicKey || creatingLoan"
          >
            @if (creatingLoan) {
            <mat-spinner diameter="20" class="spinner"></mat-spinner>
            Creating... } @else { Create Loan }
          </button>

          <button mat-button type="button" (click)="resetForm()" [disabled]="creatingLoan">
            Reset
          </button>
        </div>
      </div>
    </form>
  </mat-card>
</div>
